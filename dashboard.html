<!DOCTYPE html>
<!-- Player Dashboard - Main Hub - 2026-01-27 -->
<html lang="hr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Lukavac Kviz</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <script src="firebase-config.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tillana:wght@400;700&family=Metal+Mania&family=Hallock&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Tillana', cursive;
            background: linear-gradient(135deg, #fffff1 0%, #ffd995 100%);
            min-height: 100vh;
        }
        .card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(183, 88, 0, 0.2);
        }
        .fox-logo {
            font-family: 'Metal Mania', cursive;
            color: #b75800;
            font-size: 2.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        .menu-btn {
            background: linear-gradient(135deg, #ffffff 0%, #ffd995 100%);
            border: 3px solid #b75800;
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        .menu-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(183, 88, 0, 0.3);
            background: linear-gradient(135deg, #ffd995 0%, #b75800 100%);
            color: white;
        }
        .quiz-card {
            background: linear-gradient(135deg, #fff5e6 0%, #ffe6cc 100%);
            border: 2px solid #b75800;
            border-radius: 15px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .quiz-card:hover {
            transform: scale(1.02);
            box-shadow: 0 5px 20px rgba(183, 88, 0, 0.3);
        }
        .quiz-live {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: bold;
        }
        .badge-live { background: #10b981; color: white; }
        .badge-scheduled { background: #3b82f6; color: white; }
        .badge-finished { background: #6b7280; color: white; }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="bg-white shadow-lg">
        <div class="container mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <img src="cunning_logo_lukavac.png" alt="Logo" class="w-12 h-12">
                    <div class="fox-logo">LUKAVAC</div>
                </div>
                <div class="flex items-center gap-4">
                    <div class="text-right">
                        <p class="text-sm text-gray-600">Dobrodo≈°ao,</p>
                        <p class="font-bold" style="color: #b75800;" id="playerName">-</p>
                    </div>
                    <img id="playerPhoto" src="https://via.placeholder.com/50?text=üë§" 
                         class="w-12 h-12 rounded-full border-2 border-yellow-600 object-cover cursor-pointer"
                         onclick="showMyProfile()">
                </div>
            </div>
        </div>
    </div>

    <div class="container mx-auto px-4 py-6">
        <!-- Quick Stats -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
            <div class="card p-4 text-center">
                <div class="text-3xl mb-2">üèÜ</div>
                <p class="text-2xl font-bold" style="color: #b75800;" id="statWins">0</p>
                <p class="text-sm text-gray-600">Pobjede</p>
            </div>
            <div class="card p-4 text-center">
                <div class="text-3xl mb-2">üí∞</div>
                <p class="text-2xl font-bold" style="color: #10b981;" id="statEarnings">0‚Ç¨</p>
                <p class="text-sm text-gray-600">Ukupna Zarada</p>
            </div>
            <div class="card p-4 text-center">
                <div class="text-3xl mb-2">‚≠ê</div>
                <p class="text-2xl font-bold" style="color: #f59e0b;" id="statRating">0</p>
                <p class="text-sm text-gray-600">Prosjeƒçna Ocjena</p>
            </div>
            <div class="card p-4 text-center">
                <div class="text-3xl mb-2">üìä</div>
                <p class="text-2xl font-bold" style="color: #3b82f6;" id="statRank">#-</p>
                <p class="text-sm text-gray-600">Trenutni Rang</p>
            </div>
        </div>

        <!-- Main Menu Grid -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
            <div class="menu-btn" onclick="showQuizzes()">
                <div class="text-4xl mb-2">üéÆ</div>
                <p class="font-bold text-lg">KVIZOVI</p>
                <p class="text-xs text-gray-600">Pregledaj i pridru≈æi se</p>
            </div>
            
            <div class="menu-btn" onclick="showResults()">
                <div class="text-4xl mb-2">üìä</div>
                <p class="font-bold text-lg">REZULTATI</p>
                <p class="text-xs text-gray-600">Pro≈°li kvizovi</p>
            </div>
            
            <div class="menu-btn" onclick="showRankings()">
                <div class="text-4xl mb-2">üèÜ</div>
                <p class="font-bold text-lg">RANG LISTA</p>
                <p class="text-xs text-gray-600">Svi igraƒçi</p>
            </div>
            
            <div class="menu-btn" onclick="showMyProfile()">
                <div class="text-4xl mb-2">üë§</div>
                <p class="font-bold text-lg">MOJ PROFIL</p>
                <p class="text-xs text-gray-600">Uredi podatke</p>
            </div>
            
            <div class="menu-btn" onclick="showRules()">
                <div class="text-4xl mb-2">üìã</div>
                <p class="font-bold text-lg">PRAVILA</p>
                <p class="text-xs text-gray-600">Kako se igra</p>
            </div>
            
            <div class="menu-btn" onclick="showNews()">
                <div class="text-4xl mb-2">üì∞</div>
                <p class="font-bold text-lg">NOVOSTI</p>
                <p class="text-xs text-gray-600">Najnovije vijesti</p>
            </div>
            
            <div class="menu-btn" onclick="showDonations()">
                <div class="text-4xl mb-2">üíù</div>
                <p class="font-bold text-lg">DONACIJE</p>
                <p class="text-xs text-gray-600">Podr≈æi projekt</p>
            </div>
            
            <div class="menu-btn" onclick="showContact()">
                <div class="text-4xl mb-2">üìß</div>
                <p class="font-bold text-lg">KONTAKT</p>
                <p class="text-xs text-gray-600">Kontaktiraj nas</p>
            </div>
        </div>

        <!-- Live & Upcoming Quizzes -->
        <div class="card p-6 mb-6">
            <h2 class="text-2xl font-bold mb-4" style="color: #b75800;">üî• U≈æivo & Nadolazeƒái Kvizovi</h2>
            <div id="liveQuizzes" class="space-y-3">
                <p class="text-gray-500">Uƒçitavam kvizove...</p>
            </div>
        </div>

        <!-- Recent Results -->
        <div class="card p-6">
            <h2 class="text-2xl font-bold mb-4" style="color: #b75800;">üìà Tvoji Nedavni Rezultati</h2>
            <div id="recentResults" class="space-y-2">
                <p class="text-gray-500">Nema rezultata</p>
            </div>
        </div>
    </div>

    <script>
        let playerProfile = null;
        let playerProfileId = null;

        // Load player data on page load
        window.onload = function() {
            playerProfileId = sessionStorage.getItem('playerProfileId');
            
            if (!playerProfileId) {
                // Not logged in - redirect to login
                window.location.href = 'login.html';
                return;
            }
            
            // Load player profile
            const profileData = sessionStorage.getItem('playerProfile');
            if (profileData) {
                playerProfile = JSON.parse(profileData);
                displayPlayerInfo();
                loadStats();
            }
            
            // Load live quizzes
            loadQuizzes();
            
            // Load recent results
            loadRecentResults();
        };

        function displayPlayerInfo() {
            const displayName = playerProfile.nickname || playerProfile.firstName || 'Igraƒç';
            document.getElementById('playerName').textContent = displayName;
            
            if (playerProfile.profilePhoto) {
                document.getElementById('playerPhoto').src = playerProfile.profilePhoto;
            }
        }

        function loadStats() {
            document.getElementById('statWins').textContent = playerProfile.wins || 0;
            document.getElementById('statEarnings').textContent = (playerProfile.stats?.totalEarnings || 0) + '‚Ç¨';
            document.getElementById('statRating').textContent = (playerProfile.stats?.averageRating || 0).toFixed(1);
            document.getElementById('statRank').textContent = '#' + (playerProfile.stats?.currentRank || '-');
        }

        function loadQuizzes() {
            // Load scheduled quizzes from Firebase
            database.ref('scheduledQuizzes').orderByChild('startTime').once('value').then(snap => {
                const quizzes = snap.val();
                let html = '';
                
                if (!quizzes) {
                    html = '<p class="text-gray-500">Nema zakazanih kvizova</p>';
                } else {
                    const now = Date.now();
                    const quizArray = Object.entries(quizzes).map(([id, data]) => ({id, ...data}));
                    
                    // Sort by start time
                    quizArray.sort((a, b) => a.startTime - b.startTime);
                    
                    quizArray.forEach(quiz => {
                        const isLive = quiz.status === 'live';
                        const isScheduled = quiz.startTime > now;
                        const isFinished = quiz.status === 'finished';
                        
                        const badge = isLive ? '<span class="badge badge-live">üî¥ U≈ΩIVO</span>' :
                                     isScheduled ? '<span class="badge badge-scheduled">üìÖ ZAKAZANO</span>' :
                                     '<span class="badge badge-finished">‚úÖ ZAVR≈†ENO</span>';
                        
                        const startDate = new Date(quiz.startTime);
                        const timeStr = startDate.toLocaleString('hr-HR', {
                            day: '2-digit',
                            month: '2-digit',
                            year: 'numeric',
                            hour: '2-digit',
                            minute: '2-digit'
                        });
                        
                        const cardClass = isLive ? 'quiz-card quiz-live' : 'quiz-card';
                        
                        html += `
                            <div class="${cardClass}" onclick="joinQuiz('${quiz.id}')">
                                <div class="flex justify-between items-start mb-2">
                                    <div>
                                        <h3 class="font-bold text-lg">${quiz.name}</h3>
                                        <p class="text-sm text-gray-600">üïê ${timeStr}</p>
                                    </div>
                                    ${badge}
                                </div>
                                <div class="grid grid-cols-3 gap-2 text-xs mt-3">
                                    <div>üí∞ ${quiz.prizePool || 0}‚Ç¨</div>
                                    <div>üë• ${quiz.playerCount || 0} igraƒça</div>
                                    <div>‚ùì ${quiz.questionCount || 10} pitanja</div>
                                </div>
                                ${isLive ? '<p class="text-sm font-bold mt-2">‚ö° Pridru≈æi se odmah!</p>' : ''}
                            </div>
                        `;
                    });
                }
                
                document.getElementById('liveQuizzes').innerHTML = html;
            });
        }

        function loadRecentResults() {
            // Load player's recent quiz results
            database.ref(`playerResults/${playerProfileId}`).limitToLast(5).once('value').then(snap => {
                const results = snap.val();
                let html = '';
                
                if (!results) {
                    html = '<p class="text-gray-500">Nema≈° rezultata</p>';
                } else {
                    Object.entries(results).reverse().forEach(([quizId, result]) => {
                        const rankColor = result.rank <= 3 ? '#10b981' : result.rank <= 10 ? '#f59e0b' : '#6b7280';
                        const date = new Date(result.timestamp).toLocaleDateString('hr-HR');
                        
                        html += `
                            <div class="p-3 bg-gray-50 rounded-lg flex justify-between items-center">
                                <div>
                                    <p class="font-bold">${result.quizName}</p>
                                    <p class="text-sm text-gray-600">${date}</p>
                                </div>
                                <div class="text-right">
                                    <p class="font-bold text-xl" style="color: ${rankColor};">#${result.rank}</p>
                                    <p class="text-sm font-bold" style="color: #10b981;">+${result.earnings}‚Ç¨</p>
                                    <p class="text-xs text-gray-600">‚≠ê ${result.rating}/10</p>
                                </div>
                            </div>
                        `;
                    });
                }
                
                document.getElementById('recentResults').innerHTML = html;
            });
        }

        function joinQuiz(quizId) {
            sessionStorage.setItem('currentQuizId', quizId);
            window.location.href = 'player.html';
        }

        function showQuizzes() {
            window.location.href = 'quizzes.html';
        }

        function showResults() {
            window.location.href = 'results.html';
        }

        function showRankings() {
            window.location.href = 'rankings.html';
        }

        function showMyProfile() {
            window.location.href = 'profile.html';
        }

        function showRules() {
            window.location.href = 'rules.html';
        }

        function showNews() {
            window.location.href = 'news.html';
        }

        function showDonations() {
            window.location.href = 'donations.html';
        }

        function showContact() {
            window.location.href = 'contact.html';
        }
    </script>
</body>
</html>
