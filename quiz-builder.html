<!DOCTYPE html>
<!-- ULTIMATE QUIZ BUILDER - Round-by-Round Setup + Notifications - 2026-01-27 -->
<html lang="hr">
<head>
    <meta charset="UTF-8">
    <title>Quiz Builder - Lukavac</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="firebase-config.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        body { font-family: Arial; background: #f5f5f5; margin: 0; }
        .card { background: white; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); padding: 20px; margin-bottom: 20px; }
        .btn { padding: 10px 20px; border-radius: 8px; border: none; cursor: pointer; font-weight: bold; transition: all 0.2s; }
        .btn-primary { background: #3b82f6; color: white; }
        .btn-primary:hover { background: #2563eb; }
        .btn-success { background: #10b981; color: white; }
        .btn-success:hover { background: #059669; }
        .btn-danger { background: #ef4444; color: white; }
        .btn-danger:hover { background: #dc2626; }
        .btn-warning { background: #f59e0b; color: white; }
        input, select, textarea { width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; margin-bottom: 10px; box-sizing: border-box; }
        .round-card { border: 2px solid #e5e7eb; border-radius: 8px; padding: 15px; margin-bottom: 15px; background: #f9fafb; }
        .round-card.active { border-color: #3b82f6; background: #eff6ff; }
        .question-item { border: 1px solid #e5e7eb; border-radius: 6px; padding: 10px; margin-bottom: 8px; cursor: pointer; background: white; }
        .question-item.selected { background: #dbeafe; border-color: #3b82f6; }
        .question-item:hover { background: #f3f4f6; }
        .step { display: none; }
        .step.active { display: block; }
        .step-indicator { display: flex; justify-content: space-between; margin-bottom: 30px; }
        .step-dot { width: 40px; height: 40px; border-radius: 50%; background: #e5e7eb; display: flex; align-items: center; justify-content: center; font-weight: bold; }
        .step-dot.active { background: #3b82f6; color: white; }
        .step-dot.completed { background: #10b981; color: white; }
    </style>
</head>
<body class="p-6">
    <div class="max-w-7xl mx-auto">
        <div class="card">
            <h1 class="text-3xl font-bold mb-2">üéÆ Quiz Builder - Ultimate Setup</h1>
            <p class="text-gray-600 mb-4">Kompletan setup kviza sa postavkama po krugovima</p>
            
            <!-- Step Indicator -->
            <div class="step-indicator">
                <div class="step-dot active" id="dot-1">1</div>
                <div class="step-dot" id="dot-2">2</div>
                <div class="step-dot" id="dot-3">3</div>
                <div class="step-dot" id="dot-4">4</div>
                <div class="step-dot" id="dot-5">5</div>
                <div class="step-dot" id="dot-6">6</div>
            </div>
        </div>

        <!-- STEP 1: Basic Info -->
        <div class="step active" id="step-1">
            <div class="card">
                <h2 class="text-2xl font-bold mb-4">Korak 1: Osnovne Informacije</h2>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="font-bold">Naziv Kviza:</label>
                        <input type="text" id="quizName" placeholder="Lukavac Sata 08:00">
                    </div>
                    <div>
                        <label class="font-bold">Tip:</label>
                        <select id="quizType">
                            <option value="sata">üïê Lukavac Sata</option>
                            <option value="dana">üåô Lukavac Dana</option>
                            <option value="noci">üåÉ Lukavac Noƒái</option>
                            <option value="premium">üíé Lukavac Premium</option>
                            <option value="tjedna">üìÖ Lukavac Tjedna</option>
                            <option value="mjeseca">üìÜ Lukavac Mjeseca</option>
                        </select>
                    </div>
                    <div>
                        <label class="font-bold">Datum i Vrijeme Poƒçetka:</label>
                        <input type="datetime-local" id="quizStartTime">
                    </div>
                    <div>
                        <label class="font-bold">Nagradni Fond (‚Ç¨):</label>
                        <input type="number" id="quizPrize" value="1000">
                    </div>
                    <div>
                        <label class="font-bold">Max Broj Igraƒça:</label>
                        <input type="number" id="quizMaxPlayers" value="100">
                    </div>
                    <div>
                        <label class="font-bold">Cijena Ulaznice (‚Ç¨):</label>
                        <input type="number" id="quizTicketPrice" value="1" step="0.1">
                    </div>
                    <div>
                        <label class="font-bold">≈†ifra Kviza:</label>
                        <input type="text" id="quizPassword" value="lukavac123">
                    </div>
                    <div>
                        <label class="font-bold">Broj Krugova:</label>
                        <input type="number" id="numRounds" value="3" min="1" max="10" onchange="updateRoundsCount()">
                    </div>
                </div>
                <button onclick="nextStep(1)" class="btn btn-primary mt-4">Sljedeƒáe: Import Pitanja ‚Üí</button>
            </div>
        </div>

        <!-- STEP 2: Import Questions -->
        <div class="step" id="step-2">
            <div class="card">
                <h2 class="text-2xl font-bold mb-4">Korak 2: Import Pitanja</h2>
                <div class="mb-4">
                    <label class="font-bold">Import CSV:</label>
                    <input type="file" id="csvImport" accept=".csv">
                    <button onclick="importQuestions()" class="btn btn-success mt-2">üì• Import</button>
                </div>
                <div class="mb-4">
                    <p class="font-bold">ILI dodaj pojedinaƒçno:</p>
                    <input type="text" id="quickQ" placeholder="Pitanje">
                    <div class="grid grid-cols-4 gap-2">
                        <input type="text" id="quickA" placeholder="A">
                        <input type="text" id="quickB" placeholder="B">
                        <input type="text" id="quickC" placeholder="C">
                        <input type="text" id="quickD" placeholder="D">
                    </div>
                    <div class="grid grid-cols-3 gap-2">
                        <select id="quickCorrect">
                            <option value="0">A toƒçan</option><option value="1">B</option>
                            <option value="2">C</option><option value="3">D</option>
                        </select>
                        <select id="quickCat">
                            <option>Sport</option><option>Geografija</option><option>Povijest</option>
                            <option>Kultura</option><option>Znanost</option>
                        </select>
                        <select id="quickDiff">
                            <option value="1">‚≠ê 1</option><option value="2">‚≠ê‚≠ê 2</option>
                            <option value="3">‚≠ê‚≠ê‚≠ê 3</option><option value="4">‚≠ê‚≠ê‚≠ê‚≠ê 4</option>
                            <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê 5</option>
                        </select>
                    </div>
                    <button onclick="addQuickQuestion()" class="btn btn-success">‚ûï Dodaj Pitanje</button>
                </div>
                <div class="mb-4">
                    <p class="font-bold">Ukupno pitanja: <span id="totalQuestions">0</span></p>
                </div>
                <div class="flex gap-2">
                    <button onclick="prevStep(2)" class="btn btn-warning">‚Üê Nazad</button>
                    <button onclick="nextStep(2)" class="btn btn-primary">Sljedeƒáe: Odaberi Pitanja po Krugovima ‚Üí</button>
                </div>
            </div>
        </div>

        <!-- STEP 3: Assign Questions to Rounds -->
        <div class="step" id="step-3">
            <div class="card">
                <h2 class="text-2xl font-bold mb-4">Korak 3: Odaberi Pitanja po Krugovima</h2>
                <p class="text-gray-600 mb-4">Odaberi pitanja za svaki krug u ≈æeljenom redoslijedu</p>
                <div id="roundAssignment"></div>
                <div class="flex gap-2 mt-4">
                    <button onclick="prevStep(3)" class="btn btn-warning">‚Üê Nazad</button>
                    <button onclick="nextStep(3)" class="btn btn-primary">Sljedeƒáe: Postavke po Krugovima ‚Üí</button>
                </div>
            </div>
        </div>

        <!-- STEP 4: Round-by-Round Settings -->
        <div class="step" id="step-4">
            <div class="card">
                <h2 class="text-2xl font-bold mb-4">Korak 4: Postavke po Krugovima</h2>
                <div id="roundSettings"></div>
                <div class="flex gap-2 mt-4">
                    <button onclick="prevStep(4)" class="btn btn-warning">‚Üê Nazad</button>
                    <button onclick="nextStep(4)" class="btn btn-primary">Sljedeƒáe: Globalne Postavke ‚Üí</button>
                </div>
            </div>
        </div>

        <!-- STEP 5: Global Settings -->
        <div class="step" id="step-5">
            <div class="card">
                <h2 class="text-2xl font-bold mb-4">Korak 5: Globalne Postavke</h2>
                
                <h3 class="font-bold text-lg mb-3">üí∞ Bodovanje</h3>
                <div class="grid grid-cols-3 gap-4 mb-4">
                    <div class="border rounded p-3">
                        <p class="font-bold mb-2">Uzviƒçnik (!)</p>
                        <label>Toƒçno:</label>
                        <input type="number" id="globalExclamCorrect" value="150">
                        <label>Krivo:</label>
                        <input type="number" id="globalExclamWrong" value="-50">
                    </div>
                    <div class="border rounded p-3">
                        <p class="font-bold mb-2">Toƒçka (.)</p>
                        <label>Toƒçno:</label>
                        <input type="number" id="globalPeriodCorrect" value="50">
                        <label>Krivo:</label>
                        <input type="number" id="globalPeriodWrong" value="-10">
                    </div>
                    <div class="border rounded p-3">
                        <p class="font-bold mb-2">Upitnik (?)</p>
                        <label>Toƒçno:</label>
                        <input type="number" id="globalLukavacCorrect" value="50">
                        <label>Krivo:</label>
                        <input type="number" id="globalLukavacWrong" value="-25">
                    </div>
                </div>

                <h3 class="font-bold text-lg mb-3">‚öôÔ∏è Auto-Continue Postavke</h3>
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="flex items-center">
                            <input type="checkbox" id="globalEarlyContinue" checked class="mr-2">
                            <span>Auto-nastavi kad svi odgovore</span>
                        </label>
                    </div>
                    <div>
                        <label class="flex items-center">
                            <input type="checkbox" id="globalSkipLukavac" checked class="mr-2">
                            <span>Preskoƒçi lukavac fazu ako nema ?</span>
                        </label>
                    </div>
                </div>

                <h3 class="font-bold text-lg mb-3">‚è∏Ô∏è Pauza Postavke</h3>
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="font-bold">Globalno Pauza Vrijeme (s):</label>
                        <input type="number" id="globalPauseTime" value="3">
                    </div>
                    <div>
                        <label class="font-bold">Pauza Mode:</label>
                        <select id="globalPauseMode">
                            <option value="auto">Auto - Nastavi automatski</option>
                            <option value="manual">Manual - ƒåekaj admin klik</option>
                        </select>
                    </div>
                </div>

                <h3 class="font-bold text-lg mb-3">üìä Eliminacija Igraƒça</h3>
                <div class="grid grid-cols-3 gap-4 mb-4">
                    <div>
                        <label class="font-bold">Eliminacija u Krugu 1:</label>
                        <select id="elimRound1">
                            <option value="0">Nema eliminacije</option>
                            <option value="25">Eliminiraj 25%</option>
                            <option value="50">Eliminiraj 50%</option>
                        </select>
                    </div>
                    <div>
                        <label class="font-bold">Eliminacija u Krugu 2:</label>
                        <select id="elimRound2">
                            <option value="0">Nema eliminacije</option>
                            <option value="25">Eliminiraj 25%</option>
                            <option value="50" selected>Eliminiraj 50%</option>
                        </select>
                    </div>
                    <div>
                        <label class="font-bold">Eliminacija u Krugu 3:</label>
                        <select id="elimRound3">
                            <option value="0">Nema eliminacije</option>
                            <option value="25">Eliminiraj 25%</option>
                            <option value="50">Eliminiraj 50%</option>
                        </select>
                    </div>
                </div>

                <h3 class="font-bold text-lg mb-3">üîî Notifikacije</h3>
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="flex items-center">
                            <input type="checkbox" id="notifyStart" checked class="mr-2">
                            <span>Po≈°alji notifikaciju 1min prije starta</span>
                        </label>
                    </div>
                    <div>
                        <label class="flex items-center">
                            <input type="checkbox" id="notifyElimination" checked class="mr-2">
                            <span>Notifikacija pri eliminaciji</span>
                        </label>
                    </div>
                </div>

                <div class="flex gap-2 mt-4">
                    <button onclick="prevStep(5)" class="btn btn-warning">‚Üê Nazad</button>
                    <button onclick="nextStep(5)" class="btn btn-primary">Sljedeƒáe: Pregled i Kreiranje ‚Üí</button>
                </div>
            </div>
        </div>

        <!-- STEP 6: Review and Create -->
        <div class="step" id="step-6">
            <div class="card">
                <h2 class="text-2xl font-bold mb-4">Korak 6: Pregled i Kreiranje</h2>
                <div id="reviewSummary"></div>
                <div class="flex gap-2 mt-6">
                    <button onclick="prevStep(6)" class="btn btn-warning">‚Üê Nazad</button>
                    <button onclick="createQuiz()" class="btn btn-success text-xl p-4">üöÄ KREIRAJ KVIZ</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentStep = 1;
        let allQuestions = [];
        let roundQuestions = {}; // {1: [q1, q2], 2: [q3, q4], ...}
        let roundSettings = {};

        function nextStep(step) {
            if (step === 1) {
                if (!document.getElementById('quizName').value || !document.getElementById('quizStartTime').value) {
                    alert('Popuni naziv i vrijeme!');
                    return;
                }
            }
            if (step === 2) {
                if (allQuestions.length === 0) {
                    alert('Dodaj barem 1 pitanje!');
                    return;
                }
            }
            
            document.getElementById(`step-${step}`).classList.remove('active');
            document.getElementById(`dot-${step}`).classList.remove('active');
            document.getElementById(`dot-${step}`).classList.add('completed');
            
            currentStep = step + 1;
            document.getElementById(`step-${currentStep}`).classList.add('active');
            document.getElementById(`dot-${currentStep}`).classList.add('active');
            
            if (currentStep === 3) renderRoundAssignment();
            if (currentStep === 4) renderRoundSettings();
            if (currentStep === 6) renderReview();
        }

        function prevStep(step) {
            document.getElementById(`step-${step}`).classList.remove('active');
            document.getElementById(`dot-${step}`).classList.remove('active');
            
            currentStep = step - 1;
            document.getElementById(`step-${currentStep}`).classList.add('active');
            document.getElementById(`dot-${currentStep}`).classList.add('active');
            document.getElementById(`dot-${currentStep}`).classList.remove('completed');
        }

        function updateRoundsCount() {
            const numRounds = parseInt(document.getElementById('numRounds').value);
            for (let i = 1; i <= numRounds; i++) {
                if (!roundQuestions[i]) roundQuestions[i] = [];
                if (!roundSettings[i]) roundSettings[i] = {
                    time1: 20, time2: 5, time3: 5, pauseTime: 3, 
                    eliminationPercent: 0, prizePool: 0
                };
            }
        }

        function importQuestions() {
            const file = document.getElementById('csvImport').files[0];
            if (!file) { alert('Odaberi CSV!'); return; }
            
            Papa.parse(file, {
                complete: (results) => {
                    const questions = results.data.slice(1).filter(row => row.length >= 8);
                    questions.forEach(row => {
                        allQuestions.push({
                            id: 'q' + Date.now() + Math.random(),
                            text: row[0],
                            answers: [row[1], row[2], row[3], row[4]],
                            correct: parseInt(row[5]),
                            category: row[6],
                            difficulty: parseInt(row[7])
                        });
                    });
                    document.getElementById('totalQuestions').textContent = allQuestions.length;
                    alert(`‚úÖ Importirano ${questions.length} pitanja!`);
                }
            });
        }

        function addQuickQuestion() {
            const q = {
                id: 'q' + Date.now(),
                text: document.getElementById('quickQ').value,
                answers: [
                    document.getElementById('quickA').value,
                    document.getElementById('quickB').value,
                    document.getElementById('quickC').value,
                    document.getElementById('quickD').value
                ],
                correct: parseInt(document.getElementById('quickCorrect').value),
                category: document.getElementById('quickCat').value,
                difficulty: parseInt(document.getElementById('quickDiff').value)
            };
            
            if (!q.text || !q.answers[0]) {
                alert('Popuni pitanje i odgovore!');
                return;
            }
            
            allQuestions.push(q);
            document.getElementById('totalQuestions').textContent = allQuestions.length;
            document.getElementById('quickQ').value = '';
            document.getElementById('quickA').value = '';
            document.getElementById('quickB').value = '';
            document.getElementById('quickC').value = '';
            document.getElementById('quickD').value = '';
        }

        function renderRoundAssignment() {
            const numRounds = parseInt(document.getElementById('numRounds').value);
            let html = '';
            
            for (let r = 1; r <= numRounds; r++) {
                html += `
                    <div class="round-card">
                        <h3 class="font-bold text-lg mb-3">Krug ${r} - Odaberi pitanja (klikni za dodati/maknuti)</h3>
                        <p class="text-sm text-gray-600 mb-2">Odabrano: <span id="round${r}Count">${(roundQuestions[r] || []).length}</span> pitanja</p>
                        <div id="round${r}Questions"></div>
                    </div>
                `;
            }
            
            document.getElementById('roundAssignment').innerHTML = html;
            
            // Render available questions for each round
            for (let r = 1; r <= numRounds; r++) {
                renderRoundQuestions(r);
            }
        }

        function renderRoundQuestions(roundNum) {
            const assignedQuestions = Object.values(roundQuestions).flat();
            const availableQuestions = allQuestions.filter(q => 
                !assignedQuestions.includes(q.id) || (roundQuestions[roundNum] || []).includes(q.id)
            );
            
            let html = '';
            availableQuestions.forEach(q => {
                const isSelected = (roundQuestions[roundNum] || []).includes(q.id);
                html += `
                    <div class="question-item ${isSelected ? 'selected' : ''}" onclick="toggleQuestionInRound(${roundNum}, '${q.id}')">
                        <strong>${q.text}</strong><br>
                        <small>${q.answers.join(' | ')} | Toƒçan: ${q.answers[q.correct]} | ${q.category} | ‚≠ê ${q.difficulty}/5</small>
                    </div>
                `;
            });
            
            document.getElementById(`round${roundNum}Questions`).innerHTML = html || '<p class="text-gray-500">Sva pitanja dodijeljena</p>';
        }

        function toggleQuestionInRound(roundNum, questionId) {
            if (!roundQuestions[roundNum]) roundQuestions[roundNum] = [];
            
            const index = roundQuestions[roundNum].indexOf(questionId);
            if (index > -1) {
                roundQuestions[roundNum].splice(index, 1);
            } else {
                roundQuestions[roundNum].push(questionId);
            }
            
            document.getElementById(`round${roundNum}Count`).textContent = roundQuestions[roundNum].length;
            
            // Re-render all rounds
            const numRounds = parseInt(document.getElementById('numRounds').value);
            for (let r = 1; r <= numRounds; r++) {
                renderRoundQuestions(r);
            }
        }

        function renderRoundSettings() {
            const numRounds = parseInt(document.getElementById('numRounds').value);
            let html = '';
            
            for (let r = 1; r <= numRounds; r++) {
                const settings = roundSettings[r] || {};
                html += `
                    <div class="round-card">
                        <h3 class="font-bold text-lg mb-3">Krug ${r} - Postavke (${(roundQuestions[r] || []).length} pitanja)</h3>
                        <div class="grid grid-cols-4 gap-3">
                            <div>
                                <label class="font-bold">Faza 1 (s):</label>
                                <input type="number" id="r${r}Time1" value="${settings.time1 || 20}">
                            </div>
                            <div>
                                <label class="font-bold">Faza 2 (s):</label>
                                <input type="number" id="r${r}Time2" value="${settings.time2 || 5}">
                            </div>
                            <div>
                                <label class="font-bold">Faza 3 (s):</label>
                                <input type="number" id="r${r}Time3" value="${settings.time3 || 5}">
                            </div>
                            <div>
                                <label class="font-bold">Pauza (s):</label>
                                <input type="number" id="r${r}Pause" value="${settings.pauseTime || 3}">
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-3 mt-3">
                            <div>
                                <label class="font-bold">Eliminacija (%):</label>
                                <select id="r${r}Elim">
                                    <option value="0">Nema</option>
                                    <option value="25">25%</option>
                                    <option value="50">50%</option>
                                    <option value="75">75%</option>
                                </select>
                            </div>
                            <div>
                                <label class="font-bold">Nagrada Kruga (‚Ç¨):</label>
                                <input type="number" id="r${r}Prize" value="${settings.prizePool || 0}">
                            </div>
                        </div>
                    </div>
                `;
            }
            
            document.getElementById('roundSettings').innerHTML = html;
        }

        function renderReview() {
            const numRounds = parseInt(document.getElementById('numRounds').value);
            
            // Collect all settings
            for (let r = 1; r <= numRounds; r++) {
                roundSettings[r] = {
                    time1: parseInt(document.getElementById(`r${r}Time1`).value),
                    time2: parseInt(document.getElementById(`r${r}Time2`).value),
                    time3: parseInt(document.getElementById(`r${r}Time3`).value),
                    pauseTime: parseInt(document.getElementById(`r${r}Pause`).value),
                    eliminationPercent: parseInt(document.getElementById(`r${r}Elim`).value),
                    prizePool: parseInt(document.getElementById(`r${r}Prize`).value),
                    questions: (roundQuestions[r] || []).map(qId => allQuestions.find(q => q.id === qId))
                };
            }
            
            let html = `
                <div class="bg-blue-50 p-4 rounded mb-4">
                    <h3 class="font-bold text-xl mb-2">üìã Pregled Kviza</h3>
                    <p><strong>Naziv:</strong> ${document.getElementById('quizName').value}</p>
                    <p><strong>Vrijeme:</strong> ${new Date(document.getElementById('quizStartTime').value).toLocaleString()}</p>
                    <p><strong>Nagradni Fond:</strong> ${document.getElementById('quizPrize').value}‚Ç¨</p>
                    <p><strong>Max Igraƒça:</strong> ${document.getElementById('quizMaxPlayers').value}</p>
                    <p><strong>≈†ifra:</strong> ${document.getElementById('quizPassword').value}</p>
                </div>
            `;
            
            for (let r = 1; r <= numRounds; r++) {
                const s = roundSettings[r];
                html += `
                    <div class="border rounded p-4 mb-3">
                        <h4 class="font-bold text-lg">Krug ${r}</h4>
                        <p>Pitanja: ${s.questions.length}</p>
                        <p>Vremena: ${s.time1}s / ${s.time2}s / ${s.time3}s (Pauza: ${s.pauseTime}s)</p>
                        <p>Eliminacija: ${s.eliminationPercent}% | Nagrada: ${s.prizePool}‚Ç¨</p>
                        <details class="mt-2">
                            <summary class="cursor-pointer font-bold">Vidi pitanja</summary>
                            <ul class="list-disc pl-6 mt-2">
                                ${s.questions.map(q => `<li>${q.text}</li>`).join('')}
                            </ul>
                        </details>
                    </div>
                `;
            }
            
            document.getElementById('reviewSummary').innerHTML = html;
        }

        function createQuiz() {
            if (!confirm('Kreirati kviz sa svim postavkama?')) return;
            
            const numRounds = parseInt(document.getElementById('numRounds').value);
            
            // Build complete settings structure
            const rounds = [];
            const allQuizQuestions = [];
            
            for (let r = 1; r <= numRounds; r++) {
                const s = roundSettings[r];
                rounds.push({
                    roundNumber: r,
                    questionsCount: s.questions.length,
                    time1: s.time1,
                    time2: s.time2,
                    time3: s.time3,
                    pauseTime: s.pauseTime,
                    eliminationPercent: s.eliminationPercent,
                    prizePool: s.prizePool
                });
                allQuizQuestions.push(...s.questions);
            }
            
            const quizData = {
                name: document.getElementById('quizName').value,
                type: document.getElementById('quizType').value,
                startTime: new Date(document.getElementById('quizStartTime').value).getTime(),
                prizePool: parseInt(document.getElementById('quizPrize').value),
                maxPlayers: parseInt(document.getElementById('quizMaxPlayers').value),
                ticketPrice: parseFloat(document.getElementById('quizTicketPrice').value),
                password: document.getElementById('quizPassword').value,
                
                questions: allQuizQuestions,
                questionCount: allQuizQuestions.length,
                
                settings: {
                    quizName: document.getElementById('quizName').value,
                    maxPlayers: parseInt(document.getElementById('quizMaxPlayers').value),
                    password: document.getElementById('quizPassword').value,
                    rounds: rounds,
                    
                    // Global settings
                    exclamationCorrect: parseInt(document.getElementById('globalExclamCorrect').value),
                    exclamationWrong: parseInt(document.getElementById('globalExclamWrong').value),
                    periodCorrect: parseInt(document.getElementById('globalPeriodCorrect').value),
                    periodWrong: parseInt(document.getElementById('globalPeriodWrong').value),
                    lukavacCorrect: parseInt(document.getElementById('globalLukavacCorrect').value),
                    lukavacWrong: parseInt(document.getElementById('globalLukavacWrong').value),
                    
                    earlyContinue: document.getElementById('globalEarlyContinue').checked,
                    skipLukavac: document.getElementById('globalSkipLukavac').checked,
                    globalPauseTime: parseInt(document.getElementById('globalPauseTime').value),
                    pauseMode: document.getElementById('globalPauseMode').value,
                    
                    notifications: {
                        start: document.getElementById('notifyStart').checked,
                        elimination: document.getElementById('notifyElimination').checked
                    }
                },
                
                status: 'scheduled',
                playerCount: 0,
                registeredPlayers: [],
                qualifiedPlayers: [],
                ticketsSold: [],
                createdAt: Date.now()
            };
            
            const quizId = database.ref('scheduledQuizzes').push().key;
            database.ref(`scheduledQuizzes/${quizId}`).set(quizData).then(() => {
                alert('‚úÖ KVIZ KREIRAN!\n\n' +
                      `ID: ${quizId}\n` +
                      `Pitanja: ${allQuizQuestions.length}\n` +
                      `Krugovi: ${numRounds}\n\n` +
                      `Kviz je spreman!\n` +
                      `Notifikacije ƒáe se poslati 1min prije starta.`);
                
                // Schedule notification (1 minute before start)
                scheduleStartNotification(quizId, quizData);
                
                window.location.href = 'super-admin.html';
            });
        }

        function scheduleStartNotification(quizId, quizData) {
            const oneMinuteBefore = quizData.startTime - (60 * 1000);
            const now = Date.now();
            
            if (oneMinuteBefore > now) {
                setTimeout(() => {
                    sendNotifications(quizId, quizData);
                }, oneMinuteBefore - now);
            }
        }

        function sendNotifications(quizId, quizData) {
            // Get all registered players
            database.ref(`scheduledQuizzes/${quizId}/registeredPlayers`).once('value').then(snap => {
                const players = snap.val() || [];
                
                players.forEach(playerId => {
                    database.ref(`playerProfiles/${playerId}`).once('value').then(pSnap => {
                        const player = pSnap.val();
                        
                        // Save notification to player's notifications
                        database.ref(`notifications/${playerId}`).push({
                            type: 'quiz_starting',
                            quizId: quizId,
                            quizName: quizData.name,
                            message: `üéÆ Kviz "${quizData.name}" poƒçinje za 1 minutu!`,
                            timestamp: Date.now(),
                            read: false
                        });
                        
                        // TODO: Send push notification to mobile/web
                        // TODO: Send email/WhatsApp if enabled
                    });
                });
            });
        }

        updateRoundsCount();
    </script>
</body>
</html>
