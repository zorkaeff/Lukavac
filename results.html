<!DOCTYPE html><html lang="hr"><head><meta charset="UTF-8"><title>Rezultati</title>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
<script src="firebase-config.js"></script><script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script></head>
<body class="bg-gradient-to-br from-yellow-50 to-yellow-200 p-6">
<div class="max-w-6xl mx-auto bg-white rounded-xl shadow-lg p-8">
<div class="flex justify-between mb-6"><h1 class="text-3xl font-bold text-yellow-800">ğŸ“Š Tvoji Rezultati</h1>
<button onclick="window.location.href='dashboard.html'" class="px-4 py-2 bg-yellow-600 text-white rounded">â† Natrag</button></div>
<div class="grid grid-cols-4 gap-4 mb-6">
<div class="bg-green-100 p-4 rounded-lg text-center"><p class="text-3xl font-bold text-green-600" id="totalWins">0</p><p class="text-sm">Pobjede</p></div>
<div class="bg-blue-100 p-4 rounded-lg text-center"><p class="text-3xl font-bold text-blue-600" id="totalGames">0</p><p class="text-sm">Igre</p></div>
<div class="bg-yellow-100 p-4 rounded-lg text-center"><p class="text-3xl font-bold text-yellow-600" id="avgRating">0</p><p class="text-sm">Ocjena</p></div>
<div class="bg-purple-100 p-4 rounded-lg text-center"><p class="text-3xl font-bold text-purple-600" id="totalEarnings">0â‚¬</p><p class="text-sm">Zarada</p></div>
</div>
<div class="mb-6"><canvas id="earningsChart" height="80"></canvas></div>
<div id="resultsList" class="space-y-3"></div></div>
<script>
let allResults = [], chart = null;
window.onload = () => {
const pid = sessionStorage.getItem('playerProfileId');
if(!pid) { window.location.href='login.html'; return; }
database.ref(\`playerResults/\${pid}\`).on('value', snap => {
const r = snap.val() || {};
allResults = Object.entries(r).map(([id,d])=>({id,...d})).sort((a,b)=>b.timestamp-a.timestamp);
const wins = allResults.filter(r => r.rank === 1).length;
const avg = allResults.length ? (allResults.reduce((s,r)=>s+(r.rating||0),0)/allResults.length).toFixed(1) : 0;
const earn = allResults.reduce((s,r)=>s+(r.earnings||0),0);
document.getElementById('totalWins').textContent = wins;
document.getElementById('totalGames').textContent = allResults.length;
document.getElementById('avgRating').textContent = avg;
document.getElementById('totalEarnings').textContent = earn + 'â‚¬';
let html = '';
allResults.forEach(res => {
const date = new Date(res.timestamp).toLocaleDateString('hr-HR');
const color = res.rank===1?'green-600':res.rank<=3?'yellow-600':'gray-600';
html += \`<div class="bg-gray-50 p-4 rounded flex justify-between"><div><p class="font-bold">\${res.quizName}</p>
<p class="text-sm text-gray-600">\${date}</p></div><div class="text-right">
<p class="text-2xl font-bold text-\${color}">#\${res.rank}</p><p class="text-sm text-green-600">+\${res.earnings}â‚¬</p>
<p class="text-xs">â­ \${res.rating}/10</p></div></div>\`;
});
document.getElementById('resultsList').innerHTML = html || '<p class="text-gray-500">Nema rezultata</p>';
const ctx = document.getElementById('earningsChart').getContext('2d');
const labels = allResults.slice(0,10).reverse().map(r=>new Date(r.timestamp).toLocaleDateString('hr-HR',{day:'2-digit',month:'2-digit'}));
const data = allResults.slice(0,10).reverse().map(r=>r.earnings);
if(chart) chart.destroy();
chart = new Chart(ctx, {type:'line',data:{labels,datasets:[{label:'Zarada (â‚¬)',data,borderColor:'#10b981',backgroundColor:'rgba(16,185,129,0.1)',tension:0.4}]},options:{responsive:true}});
});
};
</script></body></html>
